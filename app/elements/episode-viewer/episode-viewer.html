<dom-module id="episode-viewer">
  <style>

   :host {
     --paper-menu-selected-item: var(--trek-selected-color);
     @apply(--layout-fit);
   }

   paper-button::shadow paper-ripple {
     color: var(--trek-primary-color);
   }
   
   paper-material {
     margin: 16px;
     height: auto;
   }

   paper-toolbar {
     background-color: var(--trek-header-color);
   }

   paper-item {
     border-width: 1px;
     border-color: var(--trek-header-color);
   }

   .episodes {
     background-color: var(--trek-white-color);
   }

   .divider {
     padding: 16px;
     margin-top: 0px;
     margin-bottom: 0px;
     font-weight: 300;
   }

   h1 {
     text-decoration: none;
     font-weight: normal;
   }

   h2 {
     color: var(--trek-white-color);
     background-color: var(--trek-header-color);
     font-weight: 300;
     padding: 16px;
   }

   iron-icon, paper-icon-button {
     color: var(--trek-highlight-color);
   }

   neon-animated-pages {
     position: static;
   }
   
  </style>


  <template>

    <neon-animated-pages id="navigationController" selected="{{_selected}}">

      <series-list selected="{{_selected}}" series="[[_series]]" series-index="{{_seriesIndex}}"></series-list>
      <episode-list selected="{{_selected}}" series="[[_selectedSeries]]" episodes="[[_selectedEpisodes]]" selected-episode="{{_selectedEpisode}}"></episode-list>
      <episode-card id="card" episode="[[_selectedEpisode]]" class="fit">
        <paper-icon-button icon="chevron-left" on-tap="goBack"></paper-icon-button>
      </episode-card>
      
    </neon-animated-pages>
    
  </template>
  <script>

   Polymer({
     is: "episode-viewer",

     behaviors: [
       Polymer.NeonSharedElementAnimatableBehavior
     ],

     properties: {
       sharedElements: {
         type: Object,
         value: function() {
           return {
             'genHero': this.$.seriesHeader,
             'genBody': this.$.seriesHeader
           }
         }
       },

       animationConfig: {
         type: Object,
         value: function() {
           return {
             // the outgoing page defines the 'exit' animation
             'exit':
             [
               {
                 name: 'hero-animation',
                 id: 'genBody',
                 fromPage: this
               },
               {
                 name: 'hero-animation',
                 id: 'genHero',
                 fromPage: this
               }
             ],
             // incoming defines the 'entry' (for hero)
             'entry':
             [
               {
                 name: 'fade-in-animation',
                 node: this
               },
               {
                 name: 'hero-animation',
                 id: 'genHero',
                 toPage: this,
                 timing: {
                   delay: 150
                 }
               }
             ]
           }
         }
       },
     
       _selected: {
         type: Number,
         value: 0,
         notify: true,
         observer: '_selectedChanged'
       },

       _series: {
         type: Array
       },

       _seriesIndex: {
         type: Number,
         notify: true,
         observer: '_indexChanged'
       },

       _selectedSeries: {
         type: Object,
         notify: true,
         reflectAttribute: true
       },

       _selectedEpisodes: {
         type: Array,
         observer: '_episodesChanged',
         notify: true,
         reflectAttribute: true
       },

       _selectedEpisode: {
         type: Object,
         notify: true
       }
       
     },

     observers: [
       '_seriesChanged(_selectedSeries, _selectedEpisodes)'
     ],

     _indexChanged: function(idx){
       console.log("_indexChanged", idx);
       var id = series[idx].title;
       /* todo; remove this, no this in observers */
       this._selectedSeries = series[idx];
       this._selectedEpisodes = data[id];
     },
     
     _seriesChanged: function(series, eps){
       console.log("series changed", series);
     },
     
     _episodesChanged: function(episodes){
       console.log("episode-viewer _episodesChanged", episodes);
     },

     _episodeChanged: function(episode){
       console.log("episode-viewer _episodeChanged", episode);
     },
     
     _selectedChanged: function(selected){
       console.log("episode-viewer selectedChanged", selected);
     },

     goBack: function(){
       this.$.navigationController.selectPrevious();
     },

     ready: function(){
       console.log("episode-viewer ready");
       this._series = series;
     }

   });

  </script>
</dom-module>


<!--
<core-list
id="episodeList"
data="{{episodeData}}"
groups="{{episodeGroups}}"
on-core-activate="{{episodeSelected}}">
</core-list>

-->
