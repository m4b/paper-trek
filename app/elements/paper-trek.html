<dom-module id="paper-trek">
  <style>
   :host {
     --paper-menu-selected-item: var(--trek-selected-color);
     --paper-menu-focused-item: var(--trek-selected-color);
     user-select: none;
   }

   paper-item[iron-selected] {
     background-color: var(--trek-selected-color);
   }

   paper-toolbar {
     background-color: var(--trek-primary-color);
     color: var(--trek-primary-text-color);
     z-index: 3;
   }

   neon-animated-pages {
     position: static;
     /*
     margin-left: 32px;
     z-index: 4;
     user-select: none;
*/
 /* this isn't doing anything */
   }
   
  </style>
  <template>
    <paper-drawer-panel id="drawerPanel">
      <paper-header-panel drawer>
	<paper-toolbar>
	  <div>Paper Trek</div>
	</paper-toolbar>
	<paper-menu selected="{{_selected}}">
          <template is="dom-repeat" items="[[_pages]]">
	    <paper-item>
              <iron-icon icon="[[item.icon]]"></iron-icon>
              <span>[[item.name]]</span>
            </paper-item>
          </template>
	</paper-menu>
      </paper-header-panel>

      <paper-header-panel main mode="standard" tall-class="medium-tall">
	<paper-toolbar>
          <paper-icon-button paper-drawer-toggle icon="menu">
          </paper-icon-button>
	  <div>{{_title}}</div>
	</paper-toolbar>
        <!-- neon-animated-pages goes here -->
        <neon-animated-pages selected="{{_selected}}">
          <episode-viewer></episode-viewer>
          <episode-generator id="episodeGenerator" settings="[[_settings.random]]"></episode-generator>
          <settings-page settings="{{_settings}}"></settings-page>
        </neon-animated-pages>
      </paper-header-panel>

    </paper-drawer-panel>

  </template>
</dom-module>
<script>
 Polymer({
   is: "paper-trek",

   properties: {

     _pages: {
       type: Array,
       readOnly: true,
       value: function(){
         return [
           {name: 'Episode Generator',
            hash:'random', icon:'refresh',
            url:'', mode:'standard'},
           {name: 'All Episodes', hash:'all',
            icon:'view-list', mode: 'standard'},
           {name: 'Settings', hash:'settings',
            icon:'settings', url:'', mode:'cover'}
         ]
       }
     },

     _mode: {
       type: String,
       value: 'standard',
       notify: true
     },

     _selected: {
       type: Number,
       value: 0,
       notify: true,
       observer: '_selectedChanged'
     },
     
     _title: {
       type: String,
       notify: true,
       computed: '_getTitle(_selected)'
     },

     /* one way data binding, flowing up from child (settings-page) */
     _settings: {
       type: Object
     }
   },

   _selectedChanged: function(selected){
     this.$.drawerPanel.closeDrawer();
     this._mode = this._pages[this._selected].mode;
     console.log("this.mode", this._mode);
   },
   
   _getTitle: function(selected){
     console.log("_pages: ", this._pages);
     console.log("getting title with: ", selected);
     return this._pages[selected].name;
   },

   ready: function(){
     console.log("paper-trek ready");
     this.$.drawerPanel.forceNarrow = true;
     
     console.log("_settings", this._settings);
     this.$.episodeGenerator.getRandomEpisode(); // this has to be called here because
     //settings isn't ready in episode-generator's ready callback
   }

 });
</script>
